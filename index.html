<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>點位搜尋輔助 v2.0.0</title>
    <link rel="icon" href="logo.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="title">
        點位搜尋輔助 v2.0.0
        <button id="editButton">編輯</button>
    </div>

    <div id="controls">
        <div class="control-group">
            <select id="kmlLayerSelect"><option value="">載入中...</option></select>
            <button id="pinButton" class="pin-btn"><span class="material-symbols-outlined">push_pin</span></button>
        </div>
        <div id="searchContainer">
            <input type="text" id="searchBox" placeholder="搜尋點位名稱..." autocomplete="off" />
            <div id="searchResults" style="display: none;"></div>
        </div>
    </div>

    <div id="authSection">
        <div id="loginForm">
            <button id="googleSignInBtn" class="action-buttons blue-btn">Google 登入</button>
        </div>

        <div id="loggedInDashboard" style="display: none;">
            <div id="userEmailDisplay" style="margin-bottom: 15px; font-weight: 600;"></div>
            
            <div id="uploadKmlSectionDashboard" class="admin-row">
                <input type="file" id="hiddenKmlFileInput" style="display: none;" accept=".kml" />
                <button onclick="document.getElementById('hiddenKmlFileInput').click()" class="action-buttons">選擇 KML</button>
                <span id="selectedKmlFileNameDashboard">未選擇檔案</span>
                <button id="uploadKmlSubmitBtnDashboard" class="action-buttons blue-btn">上傳</button>
            </div>

            <div id="deleteKmlSectionDashboard" class="admin-row">
                <select id="kmlLayerSelectDashboard"></select>
                <button id="deleteSelectedKmlBtn" class="action-buttons red-btn">刪除圖層</button>
            </div>

            <div id="registrationSettingsSection" style="display: none;">
                <button id="generateRegistrationCodeBtn" class="action-buttons green-btn">產生註冊碼</button>
                <div id="userManagementSection" style="margin-top:10px;">
                    <table style="width:100%; font-size: 12px; border-collapse: collapse;" border="1">
                        <thead><tr><th>Email</th><th>角色</th><th>操作</th></tr></thead>
                        <tbody id="userTableBody"></tbody>
                    </table>
                </div>
            </div>
            <button id="logoutBtn" class="action-buttons" style="margin-top:10px;">登出</button>
        </div>
    </div>

    <div id="map"></div>

    <div id="messageBoxOverlay" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 id="messageBoxTitle">提示</h3>
            <p id="messageBoxMessage"></p>
            <button id="messageBoxCloseBtn" class="action-buttons blue-btn">確定</button>
        </div>
    </div>

    <div id="registrationCodeModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>使用者註冊</h3>
            <input type="text" id="registrationCodeInput" placeholder="註冊碼" />
            <input type="text" id="nicknameInput" placeholder="暱稱" />
            <button id="confirmRegistrationCodeBtn" class="action-buttons blue-btn">提交</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/togeojson"></script>

    <script src="firebase-init.js"></script>
    <script src="map-logic.js"></script>
    <script src="auth-kml-management.js"></script>
    <script src="kml-worker.js"></script>
    <script src="survey-logic.js"></script>
    <script src="ui-interactions.js"></script>
</body>
</html>