<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>地圖 v4.1.0</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Inter', sans-serif;
      color: #333;
    }
    body {
      display: flex;
      flex-direction: column;
      height: 100vh;
      background-color: #f0f2f5;
    }
    #title {
      text-align: center;
      padding: 12px;
      font-size: 24px;
      font-weight: 600;
      background-color: #4CAF50;
      color: white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: relative; /* For user-info positioning */
      z-index: 1001; /* Ensure title is above map and other elements */
    }
    #map {
      flex-grow: 1;
      width: 100%;
      height: 100%; /* Take remaining height */
      z-index: 1;
    }
    .leaflet-control-locate a {
        font-size: 2em !important; /* 使圖標變大 */
    }
    .leaflet-control-layers-toggle {
        width: 36px !important;
        height: 36px !important;
        line-height: 36px !important;
        text-align: center;
        background-position: center center !important; /* 確保圖標居中 */
    }
    .search-container {
      position: absolute;
      top: 15px;
      left: 15px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      width: 280px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      border-radius: 8px;
    }
    #searchBox {
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      outline: none;
      width: 100%;
      box-sizing: border-box; /* Include padding in width */
    }
    #searchResults {
      display: none; /* Hidden by default */
      grid-template-columns: 1fr; /* Single column */
      background-color: #fff;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 8px 8px;
      max-height: 300px;
      overflow-y: auto;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: absolute; /* positioned relative to the search-container */
      z-index: 999; /* below search box */
      width: 100%; /* same width as search box */
      box-sizing: border-box;
    }
    .result-item {
      padding: 10px 15px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      font-size: 15px;
      white-space: nowrap; /* Prevent text wrapping */
      overflow: hidden;    /* Hide overflowed text */
      text-overflow: ellipsis; /* Show ellipsis for overflowed text */
    }
    .result-item:last-child {
      border-bottom: none;
    }
    .result-item:hover {
      background-color: #f0f0f0;
    }
    .nav-buttons-container {
      position: absolute;
      bottom: 15px;
      right: 15px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .nav-button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: background-color 0.3s ease;
    }
    .nav-button:hover {
      background-color: #0056b3;
    }
    .nav-button .material-symbols-outlined {
      font-size: 20px;
    }
    .import-export-container {
      position: absolute;
      bottom: 15px;
      left: 15px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .import-export-button {
      background-color: #6c757d;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: background-color 0.3s ease;
    }
    .import-export-button:hover {
      background-color: #5a6268;
    }
    .user-info {
      position: absolute;
      top: 10px;
      right: 10px;
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      z-index: 1000;
      text-align: right; /* Align content to the right */
    }
    .user-info p {
        margin: 0 0 5px 0;
        font-size: 14px;
        color: #555;
    }
    .user-info button {
        padding: 6px 12px;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-left: 5px; /* Add some space between buttons */
    }
    #auth-button {
        background-color: #007bff;
        color: white;
        border: none;
    }
    #auth-button:hover {
        background-color: #0056b3;
    }
    #logout-button {
        background-color: #dc3545;
        color: white;
        border: none;
    }
    #logout-button:hover {
        background-color: #c82333;
    }
    #ownerPanel {
      display: none; /* 預設隱藏 */
      position: absolute;
      top: 70px; /* 調整位置，不與 user-info 重疊 */
      right: 10px;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      z-index: 999;
      width: 300px;
      max-height: 80vh;
      overflow-y: auto;
      box-sizing: border-box; /* 確保 padding 不增加寬度 */
    }
    #ownerPanel h3, #ownerPanel h4 {
        margin-top: 0;
        margin-bottom: 10px;
        color: #333;
    }
    #ownerPanel button {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-bottom: 8px; /* 按鈕間距 */
        font-size: 15px;
    }
    #ownerPanel button#openRegistrationCodeButton {
        background-color: #28a745;
        color: white;
    }
    #ownerPanel button#openRegistrationCodeButton:hover {
        background-color: #218838;
    }
    #ownerPanel #registrationCodeStatus {
        margin-top: 5px;
        margin-bottom: 15px;
        font-size: 14px;
        text-align: center;
        color: #555;
    }
    #ownerPanel button#refreshPendingUsersButton {
        background-color: #6c757d;
        color: white;
    }
    #ownerPanel button#refreshPendingUsersButton:hover {
        background-color: #5a6268;
    }
    #pendingUsersList {
        margin-top: 10px;
    }
    .pending-user-item {
        border-bottom: 1px solid #eee;
        padding: 8px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
    }
    .pending-user-item:last-child {
        border-bottom: none;
    }
    .pending-user-item button.assign-editor-btn {
        width: auto; /* 讓按鈕根據內容調整寬度 */
        padding: 5px 10px;
        background-color: #007bff;
        color: white;
        font-size: 13px;
        margin-bottom: 0; /* 覆蓋父級按鈕的 margin-bottom */
    }
    .pending-user-item button.assign-editor-btn:hover {
        background-color: #0056b3;
    }
    #messageDisplayOwner {
        margin-top: 10px;
        margin-bottom: 10px;
        font-weight: bold;
        text-align: center;
    }
    .loading-spinner {
        display: none; /* 預設隱藏 */
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        animation: spin 1s linear infinite;
        margin: 5px auto;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="title">地圖 v4.1.0</div>

  <div id="map"></div>

  <div class="search-container">
    <input type="text" id="searchBox" placeholder="搜尋地標..." />
    <div id="searchResults"></div>
  </div>

  <div class="nav-buttons-container">
    </div>

  <div class="import-export-container">
    <input type="file" id="kmlInput" accept=".kml" style="display: none;" />
    <button id="importButton" class="import-export-button">
      <span class="material-symbols-outlined">upload_file</span> 匯入 KML
    </button>
    <button id="exportButton" class="import-export-button">
      <span class="material-symbols-outlined">download</span> 匯出 KML
    </button>
  </div>

  <div class="user-info" id="user-info">
    <p id="user-status">載入中...</p>
    <button id="auth-button" style="display: none;"></button>
    <button id="logout-button" style="display: none;">登出</button>
  </div>

  <div id="ownerPanel">
    <h3>Owner 管理面板</h3>
    <p id="messageDisplayOwner"></p>
    <div id="loadingSpinnerOwner" class="loading-spinner"></div>
    
    <h4>一次性註冊碼管理：</h4>
    <button id="openRegistrationCodeButton">開啟一次性註冊碼 (30秒)</button>
    <p id="registrationCodeStatus" style="font-size: 14px; text-align: center; margin-top: 5px; margin-bottom: 15px; color: #555;"></p>

    <h4>待處理用戶權限賦予：</h4>
    <button id="refreshPendingUsersButton">重新整理待處理用戶</button>
    <div id="pendingUsersList" style="margin-top: 10px;">
      <p>沒有待處理的註冊。</p>
    </div>
  </div>


  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-omnivore/0.3.4/leaflet-omnivore.min.js"></script>
  <script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />

  <script src="js/firebase-init.js"></script>
  <script src="js/map-app.js"></script>

</body>
</html>