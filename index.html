<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>點位搜尋輔助 v2.0.0</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css"> </head>
<body>
    <div id="title">
        點位搜尋輔助 v2.0.0
        <button id="editButton">編輯</button>
    </div>

    <div id="controls">
        <div class="control-group">
            <select id="kmlLayerSelect"><option value="">-- 請選擇 --</option></select>
            <button id="pinButton" class="pin-btn">📌</button>
        </div>
        <div id="searchContainer">
            <input type="text" id="searchBox" placeholder="搜尋點位..." autocomplete="off" />
            <div id="searchResults" style="display: none;"></div>
        </div>
    </div>

    <div id="authSection">
        <div id="loginForm">
            <button id="googleSignInBtn" class="action-buttons blue-btn">Google 登入</button>
        </div>
        <div id="loggedInDashboard" style="display: none;">
            <div id="userEmailDisplay" style="margin-bottom: 10px; font-weight: bold;"></div>
            
            <div class="admin-panel">
                <div class="admin-row">
                    <input type="file" id="hiddenKmlFileInput" style="display: none;" />
                    <button onclick="document.getElementById('hiddenKmlFileInput').click()" class="action-buttons">選擇 KML</button>
                    <span id="selectedKmlFileNameDashboard">尚未選擇</span>
                    <button id="uploadKmlSubmitBtnDashboard" class="action-buttons blue-btn">上傳</button>
                </div>

                <div class="admin-row">
                    <select id="kmlLayerSelectDashboard"></select>
                    <button id="deleteSelectedKmlBtn" class="action-buttons red-btn">刪除圖層</button>
                </div>

                <div id="registrationSettingsSection" style="display: none;">
                    <div class="admin-row">
                        <button id="generateRegistrationCodeBtn" class="action-buttons green-btn">產生註冊碼</button>
                    </div>
                    <table border="1" style="width:100%; margin-top:10px; font-size:12px; background:white;">
                        <thead><tr><th>Email</th><th>權限</th><th>操作</th></tr></thead>
                        <tbody id="userTableBody"></tbody>
                    </table>
                </div>
            </div>
            <button id="logoutBtn" class="action-buttons" style="margin-top:10px;">登出</button>
        </div>
    </div>

    <div id="map"></div>

    <div id="messageBoxOverlay" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 id="messageBoxTitle"></h3>
            <p id="messageBoxMessage"></p>
            <button id="messageBoxCloseBtn" class="action-buttons blue-btn">確定</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/togeojson"></script>

    <script src="firebase-init.js"></script>
    <script src="map-logic.js"></script>
    <script src="auth-kml-management.js"></script>
    <script src="kml-worker.js"></script>
    <script src="survey-logic.js"></script>
    <script src="ui-interactions.js"></script>
</body>
</html>